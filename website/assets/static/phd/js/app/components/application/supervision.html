<div class="supervision-tag">
    <div>
        <h4 class="inline-block"><b>{{ vm.supervision.supervisor.username }}</b>: </h4>
        <select ng-if="vm.username === vm.supervision.supervisor.username" class="inline-block" ng-model="vm.supervision.recommendation" ng-change="vm.recommendationChange()">
            <option ng-repeat="(key, value) in vm.applicationFieldChoices['recommendation']" value="{{key}}">{{value}}</option>
        </select>
        <h4 class="inline-block" ng-if="vm.username !== vm.supervision.supervisor.username">{{ vm.applicationFieldChoices['recommendation'][vm.supervision.recommendation] }}</h4>
    </div>
    <div>
        <i> Last modified at {{ vm.supervision.modified_at | date : 'hh:mm on dd-MM-yyyy'}}</i>
    </div>
</div>

<div class="supervision-header">
    <button ng-if="vm.isAdmin"
        class="btn btn-danger btn-sm inline-block"
        type="button"
        mwl-confirm
        title="Delete {{ vm.supervision.supervisor.username }}"
        message="Permanently delete this potential supervisor?"
        confirm-text="Yes"
        cancel-text="Cancel"
        placement="top"
        on-confirm="vm.onDelete()"
        confirm-button-type="danger"
        cancel-button-type="default">Delete Supervision</button>

    <button ng-if="vm.isAdmin && !vm.supervision.allocated"
        class="btn btn-primary btn-sm inline-block"
        type="button"
        mwl-confirm
        title="Allocation"
        message="Allocate {{ vm.supervision.supervisor.username }} as a supervisor?"
        confirm-text="Yes"
        cancel-text="Cancel"
        placement="top"
        on-confirm="vm.allocateSupervision()"
        confirm-button-type="success"
        cancel-button-type="default">Allocate Supervisor</button>

    <button ng-if="vm.isAdmin && vm.supervision.allocated"
        class="btn btn-danger btn-sm inline-block"
        type="button"
        mwl-confirm
        title="Undo Allocation"
        message="Remove allocation of {{ vm.supervision.supervisor.username }} as a supervisor?"
        confirm-text="Yes"
        cancel-text="Cancel"
        placement="top"
        on-confirm="vm.deAllocateSupervision()"
        confirm-button-type="danger"
        cancel-button-type="default">Undo Allocation</button>
</div>

<div class="supervision-content">

    <div class="col-45 inline-block">
        <span>
            <label>Comments & Justification</label>
        </span>
        <span>
            <i>({{ vm.supervision.comments.length }})</i>
        </span>

        <!-- Modal -->
        <comment-modal supervision="vm.supervision"></comment-modal>
        <br>
        <div class="comment" ng-repeat="comment in vm.supervision.comments track by comment.id">
            <div>
                <pre>{{ comment.content }}</pre>
            </div>
            <div class="comment-details">
                <span>
                    <i>posted at {{ comment.created_at | date : 'hh:mm on dd-MM-yyyy'}}</i>
                </span>
            </div>
        </div>

        <!-- Trigger Modal -->
        <div ng-if="vm.username === vm.supervision.supervisor.username" align="center">
            <button type="button" class="btn btn-sm btn-primary action-btn" data-toggle="modal" data-target="#comment-modal{{ vm.supervision.id }}">Add New Comment</button>
        </div>

        <hr>
    </div>

    <div class="col-45 inline-block supervision-cell">
        <label>Additional Material <i>({{ vm.supervision.documentations.length }})</i></label>
        <table class="table table-striped table-bordered table-condensed table-hover file-table">
            <thead>
            <tr>
                <th>File</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
            </thead>

            <tbody>
            <tr ng-repeat="additional in vm.supervisionFiles track by additional.id">
                <td>
                    <a target="_blank" href="api/applications/download/?id={{ additional.id }}&token={{ vm.access_token }}"> {{ additional.file_name }} </a>
                </td>
                <td>
                    <input type="text" ng-model="additional.description" class="form-control" readonly>
                </td>
                <td align="center">
                    <button type="button" class="btn btn-sm btn-danger" ng-click="vm.deleteFile(additional.id)">Remove</button>
                </td>
            </tr>

            <tr data-ng-repeat="newFile in vm.newFilesIndex track by $index">
                <td>
                    <div class="input-group">
                        <label class="input-group-btn">
                                <span class="btn btn-primary">
                                    Browse&hellip; <input type="file" style="display: none;" name="{{ $index }}" onchange="angular.element(this).scope().setFiles(this)">
                                </span>
                        </label>
                        <input type="text" class="form-control" ng-value="newFile['file']['name']" readonly>
                    </div>
                </td>
                <td>
                    <input type="text" ng-model="newFile.description" class="form-control">
                </td>
                <td align="center">
                    <button type="button" class="btn btn-sm btn-danger" ng-click="vm.removeFileInput($index)">Remove</button>
                    <button type="button" class="btn btn-sm btn-primary" ng-show="newFile.file != undefined" ng-click="vm.uploadFile($index)">Upload</button>
                </td>
            </tr>

            <tr ng-if="vm.username === vm.supervision.supervisor.username">
                <td></td>
                <td align="center">
                    <button type="button" class="add-fields btn btn-primary" ng-click="vm.addNewFileInput()">Add Additional Material</button>
                </td>
                <td></td>
            </tr>
            </tbody>
        </table>

    </div>

</div>
