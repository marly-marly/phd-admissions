<form role="form" ng-submit="vm.uploadApplication()">

    <h3>Basic Details</h3>

    <div class="form-group">
        <label for="registryRef">Registry Reference Number</label>
        <input type="text" class="form-control" id="registryRef" ng-model="vm.application.registry_ref" placeholder="E.g. 07362354" required>
    </div>
    <div class="form-group">
        <label for="surname">Surname</label>
        <input type="text" class="form-control" id="surname" ng-model="vm.application.surname" placeholder="E.g. Szeles" required>
    </div>
    <div class="form-group">
        <label for="forename">Forename</label>
        <input type="text" class="form-control" id="forename" ng-model="vm.application.forename" placeholder="E.g. Marton" required>
    </div>

    <div class="form-group">
        <label for="possibleFunding">Possible Funding</label>
        <select class="form-control" id="possibleFunding" ng-model="vm.application.possible_funding" required>
            <option value="" disabled selected>Please select...</option>
            <option ng-repeat="(key, value) in vm.applicationFieldChoices['possible_funding']" value="{{key}}">{{value}}</option>
        </select>
    </div>

    <div class="form-group">
        <label for="fundingStatus">Funding Status</label>
        <select class="form-control" id="fundingStatus" ng-model="vm.application.funding_status" required>
            <option value="" disabled selected>Please select...</option>
            <option ng-repeat="(key, value) in vm.applicationFieldChoices['funding_status']" value="{{key}}">{{value}}</option>
        </select>
    </div>

    <div class="form-group">
        <label for="origin">Origin (Fee Classification)</label>
        <select class="form-control" id="origin" ng-model="vm.application.origin" required>
            <option value="" disabled selected>Please select...</option>
            <option ng-repeat="(key, value) in vm.applicationFieldChoices['origin']" value="{{key}}">{{value}}</option>
        </select>
    </div>

    <div class="form-group">
        <label for="studentType">Student Type</label>
        <select class="form-control" id="studentType" ng-model="vm.application.student_type" required>
            <option value="" disabled selected>Please select...</option>
            <option ng-repeat="(key, value) in vm.applicationFieldChoices['student_type']" value="{{key}}">{{value}}</option>
        </select>
    </div>

    <h3>Documentation</h3>

    <div class="table-responsive">

        <table class="table table-striped table-bordered table-condensed table-hover">
            <thead>
                <tr>
                    <th>File Type</th>
                    <th>File Name</th>
                    <th>Description</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>

                <!-- Application Form -->
                <tr ng-show="vm.supervisionFiles['creator']['APPLICATION_FORM'] === undefined">
                    <td>
                        <h4>
                            Application Form
                        </h4>
                    </td>
                    <td>
                        <div class="input-group">
                            <label class="input-group-btn">
                                <span class="btn btn-primary">
                                    Browse&hellip; <input type="file" style="display: none;" id="APPLICATION_FORM_1" name="creator" onchange="angular.element(this).scope().setFiles(this)">
                                </span>
                            </label>
                            <input type="text" class="form-control" ng-value="vm.files['creator']['APPLICATION_FORM_1']['name']" readonly>
                        </div>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.fileDescriptions['creator']['APPLICATION_FORM_1']" class="form-control">
                    </td>
                    <td></td>
                </tr>


                <tr ng-show="vm.supervisionFiles['creator']['APPLICATION_FORM'] !== undefined">
                    <td>
                        <h4>
                            Application Form
                        </h4>
                    </td>
                    <td>
                        <a target="_blank" href="api/applications/download/?id={{ vm.supervisionFiles.creator.APPLICATION_FORM.id }}&token={{ vm.access_token }}"> {{ vm.supervisionFiles.creator.APPLICATION_FORM.file_name }} </a>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.supervisionFiles['creator']['APPLICATION_FORM']['description']" class="form-control" readonly>
                    </td>
                    <td>
                        <button type="button" class="btn btn-xs btn-danger" ng-click="vm.deleteFile('APPLICATION_FORM', vm.supervisionFiles['creator'].APPLICATION_FORM.id, 'creator')">Remove</button>
                    </td>
                </tr>


                <!-- Research Summary -->
                <tr ng-show="vm.supervisionFiles['creator']['RESEARCH_SUMMARY'] === undefined">
                    <td>
                        <h4>
                            Research Summary
                        </h4>
                    </td>
                    <td>
                        <div class="input-group">
                            <label class="input-group-btn">
                                <span class="btn btn-primary">
                                    Browse&hellip; <input type="file" style="display: none;" id="RESEARCH_SUMMARY_1" name="creator" onchange="angular.element(this).scope().setFiles(this)">
                                </span>
                            </label>
                            <input type="text" class="form-control" ng-value="vm.files['creator']['RESEARCH_SUMMARY_1']['name']" readonly>
                        </div>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.fileDescriptions['creator']['RESEARCH_SUMMARY_1']" class="form-control">
                    </td>
                    <td></td>
                </tr>

                <tr ng-show="vm.supervisionFiles['creator']['RESEARCH_SUMMARY'] !== undefined">
                    <td>
                        <h4>
                            Research Summary
                        </h4>
                    </td>
                    <td>
                        <a target="_blank" href="api/applications/download/?id={{ vm.supervisionFiles.creator.RESEARCH_SUMMARY.id }}&token={{ vm.access_token }}"> {{ vm.supervisionFiles.creator.RESEARCH_SUMMARY.file_name }} </a>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.supervisionFiles['creator']['RESEARCH_SUMMARY']['description']" class="form-control" readonly>
                    </td>
                    <td>
                        <button type="button" class="btn btn-xs btn-danger" ng-click="vm.deleteFile('RESEARCH_SUMMARY', vm.supervisionFiles['creator'].RESEARCH_SUMMARY.id, 'creator')">Remove</button>
                    </td>
                </tr>


                <!-- Reference -->
                <tr ng-repeat="additional in vm.supervisionFiles['creator']['REFERENCE'] track by additional.id">
                    <td>
                        <h4>
                            Reference {{ $index + 1 }}
                        </h4>
                    </td>
                    <td>
                        <a target="_blank" href="api/applications/download/?id={{ additional.id }}&token={{ vm.access_token }}"> {{ additional.file_name }} </a>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.supervisionFiles['creator']['REFERENCE'][$index]['description']" class="form-control" readonly>
                    </td>
                    <td>
                        <button type="button" class="btn btn-xs btn-danger" ng-click="vm.deleteFile('REFERENCE', additional.id, 'creator')">Remove</button>
                    </td>
                </tr>

                <tr data-ng-repeat="additional in vm.multiFileIndex['creator']['REFERENCE']">
                    <td>
                        <h4>
                            Reference {{ $index + 1 + vm.supervisionFiles['creator']['REFERENCE'].length }}
                        </h4>
                    </td>
                    <td>
                        <div class="input-group">
                            <label class="input-group-btn">
                                <span class="btn btn-primary">
                                    Browse&hellip; <input type="file" style="display: none;" id="REFERENCE_{{ $index }}" name="creator" onchange="angular.element(this).scope().setFiles(this)">
                                </span>
                            </label>
                            <input type="text" class="form-control" ng-value="vm.files['creator']['REFERENCE_' + {{ $index }}]['name']" readonly>
                        </div>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.fileDescriptions['creator']['REFERENCE_' + $index]" class="form-control">
                    </td>
                    <td>
                        <button type="button" class="remove" ng-click="vm.removeFileInput($index, 'REFERENCE_', 'REFERENCE', 'creator')">-</button>
                    </td>
                </tr>

                <tr>
                    <td></td>
                    <td align="center">
                        <button type="button" class="addfields btn btn-primary" ng-click="vm.addNewFileInput('REFERENCE', 'creator')">Add Reference</button>
                    </td>
                    <td></td>
                    <td></td>
                </tr>


                <!-- Additional Material -->
                <tr ng-repeat="additional in vm.supervisionFiles['creator']['ADDITIONAL_MATERIAL'] track by additional.id">
                    <td>
                        <h4>
                            Additional Material {{ $index + 1 }}
                        </h4>
                    </td>
                    <td>
                        <a target="_blank" href="api/applications/download/?id={{ additional.id }}&token={{ vm.access_token }}"> {{ additional.file_name }} </a>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.supervisionFiles['creator']['ADDITIONAL_MATERIAL'][$index]['description']" class="form-control" readonly>
                    </td>
                    <td>
                        <button type="button" class="btn btn-xs btn-danger" ng-click="vm.deleteFile('ADDITIONAL_MATERIAL', additional.id, 'creator')">Remove</button>
                    </td>
                </tr>

                <tr data-ng-repeat="additional in vm.multiFileIndex['creator']['ADDITIONAL_MATERIAL']">
                    <td>
                        <h4>
                            Additional Material {{ $index + 1 + vm.supervisionFiles['creator']['ADDITIONAL_MATERIAL'].length }}
                        </h4>
                    </td>
                    <td>
                        <div class="input-group">
                            <label class="input-group-btn">
                                <span class="btn btn-primary">
                                    Browse&hellip; <input type="file" style="display: none;" id="ADDITIONAL_MATERIAL_{{ $index }}" name="creator" onchange="angular.element(this).scope().setFiles(this)">
                                </span>
                            </label>
                            <input type="text" class="form-control" ng-value="vm.files['creator']['ADDITIONAL_MATERIAL_' + {{ $index }}]['name']" readonly>
                        </div>
                    </td>
                    <td>
                        <input type="text" ng-model="vm.fileDescriptions['creator']['ADDITIONAL_MATERIAL_' + $index]" class="form-control">
                    </td>
                    <td>
                        <button type="button" class="remove" ng-click="vm.removeFileInput($index, 'ADDITIONAL_MATERIAL_', 'ADDITIONAL_MATERIAL', 'creator')">-</button>
                    </td>
                </tr>

                <tr>
                    <td></td>
                    <td align="center">
                        <button type="button" class="addfields btn btn-primary" ng-click="vm.addNewFileInput('ADDITIONAL_MATERIAL', 'creator')">Add Additional Material</button>
                    </td>
                    <td></td>
                    <td></td>
                </tr>

                <!-- Temporary Supervisions -->
                <tr ng-repeat="temporarySupervisor in vm.temporarySupervisors">

                </tr>
            </tbody>
        </table>

    </div>

    <button ng-show="!vm.newApplication" type="button" class="btn btn-sm btn-primary" ng-click="vm.uploadFile(vm.creatorSupervision.id, 'creator')">Upload All</button>

    <h3>Research Administration</h3>

    <!-- Supervisors -->
    <label for="exampleTextarea">Potential Supervisors</label>
    <input type="text" ng-model="vm.currentlySelectedSupervisor" uib-typeahead="supervisorUsername for supervisorUsername in vm.supervisorUsernames | filter:$viewValue | limitTo:8" class="form-control" typeahead-show-hint="true" typeahead-min-length="1">

    <div class="form-group">
        <button type="button" class="btn btn-sm btn-primary" ng-click="vm.addCurrentlySelectedSupervisor()">Add</button>
    </div>

    <!-- Supervisions -->
    <div class="table-responsive">

        <table class="table table-striped table-bordered table-condensed table-hover" ts-wrapper>
            <thead>
                <tr>
                    <th ts-criteria="supervisor|parseInt" ts-default>Supervisor</th>
                    <th ts-criteria="recommendation|lowercase">Recommendation</th>
                    <th ts-criteria="modified_at|lowercase">Last Modified</th>
                    <th>Additional Material</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                <!-- Existing Supervisions -->
                <tr ng-repeat="data in vm.supervisorSupervisions track by data.id" ts-repeat>
                    <td>
                        <b>{{ data.supervisor.username }}</b>
                    </td>
                    <td>

                        <div class="form-group">
                            <select class="form-control" ng-model="data.recommendation">
                                <option ng-repeat="(key, value) in vm.applicationFieldChoices['recommendation']" value="{{key}}">{{value}}</option>
                            </select>
                        </div>

                    </td>
                    <td>
                        {{ data.modified_at }}
                    </td>
                    <td>

                        <div class="form-group">

                            <div class="file-field">
                                <fieldset data-ng-repeat="additional in vm.multiFileIndex['supervisor_' + data.id.toString()]['ADDITIONAL_MATERIAL']">
                                    <div class="form-group">

                                        <label>Additional Material {{ $index + 1 }}</label>
                                        <input type="file" class="form-control-file" id="ADDITIONAL_MATERIAL_{{ $index }}" name="supervisor_{{ data.id }}" onchange="angular.element(this).scope().setFiles(this)"/>

                                        <span>
                                            <label>Description</label>
                                            <input type="text" ng-model="vm.fileDescriptions['supervisor_' + data.id.toString()]['ADDITIONAL_MATERIAL_' + $index]" class="form-control">
                                        </span>

                                        <button type="button" class="remove" ng-click="vm.removeFileInput($index, 'ADDITIONAL_MATERIAL_', 'ADDITIONAL_MATERIAL', 'supervisor_' + data.id.toString())">-</button>
                                    </div>
                                </fieldset>
                                <button type="button" class="addfields" ng-click="vm.addNewFileInput('ADDITIONAL_MATERIAL', 'supervisor_' + data.id.toString())">Add Additional Material</button>

                                <div ng-repeat="additional in vm.supervisionFiles['supervisor_' + data.id.toString()]['ADDITIONAL_MATERIAL'] track by additional.id">
                                    <span>
                                        <a target="_blank" href="api/applications/download/?id={{ additional.id }}&token={{ vm.access_token }}"> {{ additional.file_name }} </a>
                                    </span>
                                    <span>
                                        <label>Description</label>
                                        <input type="text" ng-model="vm.supervisionFiles['supervisor_' + data.id.toString()]['ADDITIONAL_MATERIAL'][$index]['description']" class="form-control" readonly>
                                    </span>
                                    <span>
                                        <button type="button" class="btn btn-xs btn-danger" ng-click="vm.deleteFile('ADDITIONAL_MATERIAL', additional.id, 'supervisor_' + data.id.toString())">Remove</button>
                                    </span>
                                </div>
                            </div>

                        </div>

                    </td>
                    <td>
                        <button type="button" class="btn btn-sm btn-primary" ng-click="vm.updateSupervision(data)">Update</button>
                        <button type="button" class="btn btn-sm btn-danger" ng-click="vm.deleteSupervision(data.id)">Remove</button>
                    </td>
                </tr>

                <!-- Temporary Supervisions -->
                <tr ng-repeat="temporarySupervisor in vm.temporarySupervisors">
                    <td>
                        <b>{{ temporarySupervisor }}</b>
                    </td>
                    <td></td>
                    <td></td>
                    <td>
                        <button type="button" class="btn btn-xs btn-danger" ng-click="vm.removeTemporarySupervisor(temporarySupervisor)">Remove</button>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <!-- Research Details -->
    <div class="form-group">
        <label for="exampleTextarea">Research Subject</label>
        <textarea class="form-control" id="research_subject" rows="1" ng-model="vm.application.research_subject"></textarea>
    </div>

    <div class="form-group">
        <label for="exampleTextarea">Registry Comment</label>
        <textarea class="form-control" id="registry_comment" rows="3" ng-model="vm.application.registry_comment"></textarea>
    </div>

    <div class="form-group">
        <span ng-show="data.sender == 'mail' || data.sender=='system'">{{data.receiver}}</span>
        <button ng-show="vm.newApplication" class="btn btn-primary btn-lg btn-block" type="submit">Submit</button>
        <button ng-show="!vm.newApplication" class="btn btn-primary btn-lg btn-block" type="submit">Update</button>
    </div>
</form>